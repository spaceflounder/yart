import{micromark as e}from"https://esm.sh/micromark@3?bundle";import{directive as t,directiveHtml as l}from"https://esm.sh/micromark-extension-directive@3?bundle";import{gfm as i,gfmHtml as n}from"https://esm.sh/micromark-extension-gfm@3?bundle";const c=/<(\/?)(?:pre|code|kbd|script|math)[^>]*>/i,s=(e="",t="1")=>{var l,i,n,s,u,h=0;if("0"===(t="number"==typeof t?t.toString():t.replace(/\s/g,"")))return e;if("1"===t)l=1,i=1,n=1,s=1;else if("2"===t)l=1,i=1,n=2,s=1;else if("3"===t)l=1,i=1,n=3,s=1;else if("-1"===t)u=1;else for(let e=0;e<t.length;e++){let c=t[e];"q"===c&&(l=1),"b"===c&&(i=1),"B"===c&&(i=2),"d"===c&&(n=1),"D"===c&&(n=2),"i"===c&&(n=3),"e"===c&&(s=1),"w"===c&&(h=1)}var Z=p(e),B="",W=0,y="";for(let e=0;e<Z.length;e++){let t=Z[e];if("tag"===t[0]){B+=t[1];let e=c.exec(t[1]);e&&(W="/"===e[1]?0:1)}else{let e=t[1],c=e.substring(e.length-1,e.length);W||(e=m(e),h&&(e=e.replace(/$quot;/g,'"')),n&&(1===n&&(e=r(e)),2===n&&(e=g(e)),3===n&&(e=d(e))),s&&(e=b(e)),i&&(e=o(e),2===i&&(e=I(e))),l&&(e="'"===e?/\S/.test(y)?"&#8217;":"&#8216;":'"'===e?/\S/.test(y)?"&#8221;":"&#8220;":a(e)),u&&(e=G(e))),y=c,B+=e}}return B},a=e=>{var t="[!\"#$%'()*+,-./:;<=>?@[\\]^_`{|}~]",l="[^\\ \\t\\r\\n\\[\\{\\(\\-]",i="&#8211;|&#8212;";return e=(e=(e=(e=(e=(e=(e=(e=(e=(e=(e=(e=(e=e.replace(new RegExp(`^'(?=${t}\\B)`),"&#8217;")).replace(new RegExp(`^"(?=${t}\\B)`),"&#8221;")).replace(/"'(?=\w)/,"&#8220;&#8216;")).replace(/'"(?=\w)/,"&#8216;&#8220;")).replace(/'(?=\d\d)/,"&#8217;")).replace(new RegExp(`(\\s|&nbsp;|--|&[mn]dash;|${i}|&#x201[34])'(?=\\w)`,"g"),"$1&#8216;")).replace(new RegExp(`(${l})'`,"g"),"$1&#8217;")).replace(new RegExp("([\\ \\t\\r\\n\\[\\{\\(\\-]?)'(?=\\s|s\\b)","g"),"$1&#8217;")).replace(/'/g,"&#8216;")).replace(new RegExp(`(\\s|&nbsp;|--|&[mn]dash;|${i}|&#x201[34])"(?=\\w)`,"g"),"$1&#8220;")).replace(new RegExp(`(${l})"`,"g"),"$1&#8221;")).replace(new RegExp('([\\ \\t\\r\\n\\[\\{\\(\\-]?)"(?=\\s)',"g"),"$1&#8221;")).replace(/"/g,"&#8220;")},o=e=>e=(e=e.replace(/``/g,"&#8220;")).replace(/''/g,"&#8221;"),I=e=>e=(e=e.replace(/`/g,"&#8216;")).replace(/'/g,"&#8217;"),r=e=>e=e.replace(/--/g,"&#8212;"),g=e=>e=(e=e.replace(/---/g,"&#8212;")).replace(/--/g,"&#8211;"),d=e=>e=(e=e.replace(/---/g,"&#8211;")).replace(/--/g,"&#8212;"),b=e=>e=(e=e.replace(/\.\.\./g,"&#8230;")).replace(/\. \. \./g,"&#8230;"),G=e=>e=(e=(e=(e=(e=(e=(e=e.replace(/&#8211;/g,"-")).replace(/&#8212;/g,"--")).replace(/&#8216;/g,"'")).replace(/&#8217;/g,"'")).replace(/&#8220;/g,'"')).replace(/&#8221;/g,'"')).replace(/&#8230;/g,"..."),m=e=>e=(e=(e=(e=(e=(e=e.replace(/\\\\/g,"&#92;")).replace(/\\"/g,"&#34;")).replace(/\\'/g,"&#39;")).replace(/\\\./g,"&#46;")).replace(/\\-/g,"&#45;")).replace(/\\`/g,"&#96;"),p=e=>{for(var t=0,l=e.length,i=[],n=/<!--[\s\S]*?-->|<\?.*?\?>|<[^>]*>/g,c=null;c=n.exec(e);){if(t<c.index){let l=["text",e.substring(t,c.index)];i.push(l)}let l=["tag",c.toString()];i.push(l),t=n.lastIndex}if(t<l){let n=["text",e.substring(t,l)];i.push(n)}return i};let u="",h="",Z={},B={};function W(e){const t=e.matchAll(/\{\{.*\}\}/gm);if(t)for(const i of t){const t=i[0].replaceAll("{{","").replaceAll("}}",""),n=t.split(".")[0].trim();let c=t.split(".")[1].trim();if(/[A-Z]/.test(c[0])){c=c[0].toLocaleLowerCase()+c.slice(1);let i=B[n][c]??"!value not found!";i=(l=i).charAt(0).toUpperCase()+l.slice(1),e=e.replaceAll(`{{${t}}}`,i)}else{const l=B[n][c]??"!value not found!";e=e.replaceAll(`{{${t}}}`,l)}}var l;return e}function y(c){const a=document.querySelector("#out"),o=c?.state??"default";let I="";I=W("default"===o?c.msg:c[o].msg),I=s(I),I=function(c){return e(c,{extensions:[t(),i()],htmlExtensions:[l({dropcap:function(e){const t=e.content.replace("<p>","").replace("</p>","");this.tag('<div class="drop-cap">'),this.tag(t),this.tag("</div>")},aside:function(e){const t=e.content.replace("<p>","").replace("</p>","");this.tag("<aside>"),this.tag(t),this.tag("</aside>")},kbd:function(e){const t=e.label;this.tag("<kbd>"),this.tag(t),this.tag("</kbd>")},icon:function(e){const t=e.label;this.tag('<span class="material-symbols-outlined">'),this.tag(t),this.tag("</span>")}}),n()]})}(I),""!==h&&(I=h+I,h=""),a.innerHTML=I}function J(e){return!e.visible||[...e.visible].filter(e=>function(e){if(-1===e.indexOf(" "))return function(e){const t=e.split(".")[0],l=e.split(".")[1];if(B[t][l])return!0;return!1}(e);const[t,l,i]=e.split(" ");if("="===l)return x(t)===x(i);if("!="===l)return x(t)!==x(i);throw"Condition command not understood: "+e}(e)).length>0}function Y(e){const t={};if(e.buttons){const i=[...e.buttons];for(const e of i){const i=e?.label??void 0,n=J(e),c=()=>{document.querySelector("#btns").innerHTML="",e.story&&f(B,e.story);const t=e.nav;if(t&&B[t]){const l=B[t];Z={},u=t,e.msg&&(h=e.msg),v(l)}else v(),v(e)};i&&n&&(t[i]={label:(l=i,["west","north","south","east","north_west","north_east","south_west","south_east","back_hand","search","check","cancel"].indexOf(l)>-1?`<span class="material-symbols-outlined iconSize">${l}</span>`:l),action:c})}}var l;return t}function f(e,t){for(const l in t)try{t[l].constructor==Object?e[l]=f(e[l],t[l]):e[l]=t[l]}catch(i){e[l]=t[l]}return e}function x(e){const t=e.split(".")[0]??void 0,l=e.split(".")[1]??void 0;return B[t]&&B[t][l]?B[t][l]:e}function v(e){if(e||(e=B[u]),!e.msg)throw"Error: Page not implemented yet!";y(e),function(e){const t=e?.state??"default",l=document.querySelector("#btns");if(l.innerHTML="",Z={...Z,...Y(e)},"default"!==t){const l=Y(e[t]);Z={...Z,...l}}for(const e of Object.keys(Z)){const t=document.createElement("button");t.innerHTML=Z[e].label,t.onclick=Z[e].action,l.appendChild(t)}}(e)}!function(){const e=atob("eyJjYXZlTW91dGgiOiB7Im1zZyI6Ikxpa2UgdGhlIG9wZW4gbWF3IG9mIGEgZ3JlYXQgYW5kIHNpbmlzdGVyIGJlYXN0LCBhIGJsYWNrIGNhdmUgb3BlbnMgaW4gdGhlXG5jb29sIHNoYWRvd3Mgb2YgdGhlIG1vdW50YWluLiBKYWdnZWQgZGFyayBwaWxsYXJzIG9mIHN0b25lIHJpc2UgZnJvbSB0aGVcbmdyb3VuZCwgbGlrZSB0aGUgdGVldGggb2YgYSBzaGFyay5cblxuTmVhciB0aGUgb3BlbmluZyBpcyBhIHdlYXRoZXJlZCBzaWduLCBoYXN0aWx5IHNjcmF3bGVkIGluIGZhZGVkIGluay5cbiIsImJ1dHRvbnMiOlt7ImxhYmVsIjoic2VhcmNoIiwibXNnIjoiRGVzcGVyYXRlIHdhcm5pbmdzIG9mIHRlcnJpYmxlIGRlYXRoIGFyZSB3cml0dGVuIGluIG92ZXIgYSBkb3plblxubGFuZ3VhZ2VzLiBTYWRseSwgeW91IGNhbid0IHJlYWQgYW55IG9mIHRoZW0sIHNvIG9uIHdlIGdvLlxuIn0seyJsYWJlbCI6InNvdXRoIiwibmF2IjoiaW50cm8ifV19LCJjb3R0YWdlIjogeyJtc2ciOiJUaGUgaW5zaWRlIG9mIHRoZSBjb3R0YWdlIGlzIGEgdGlnaHQsIG11c3R5IHNwYWNlLCBkaW1seSBsaXQgdGhyb3VnaFxudGhlIGNyYWNrZWQgd2luZG93cyBhbmQgYnJva2VuIHJvb2YuIEEgYml0IG9mIHdvcm4gcnVnIGNvdmVycyB3aGF0J3NcbmxlZnQgb2YgdGhlIGZsb29yLlxuIiwiYnV0dG9ucyI6W3sibGFiZWwiOiJzZWFyY2giLCJtc2ciOiJUaGVyZSBzZWVtcyB0byBiZSBkcmFmdCBvZiBjb29sIGFpciBjb21pbmcgZnJvbSB1bmRlciB0aGUgcnVnLiJ9LHsibGFiZWwiOiJiYWNrX2hhbmQiLCJjbGVhciI6dHJ1ZSwibXNnIjoiWW91IHB1bGwgdGhlIHJ1ZyBhc2lkZSB0byByZXZlYWwgYSBob2xlIGRlZXAgaW50byB0aGUgZ3JvdW5kLiIsInN0b3J5Ijp7ImNvdHRhZ2UiOnsic3RhdGUiOiJvcGVuZWQifX19LHsibGFiZWwiOiJzb3V0aCIsIm5hdiI6ImhpbGxzaWRlIn1dLCJvcGVuZWQiOnsibXNnIjoiVGhlIGluc2lkZSBvZiB0aGUgY290dGFnZSBpcyBhIHRpZ2h0LCBtdXN0eSBzcGFjZSwgZGltbHkgbGl0IHRocm91Z2hcbnRoZSBjcmFja2VkIHdpbmRvd3MgYW5kIGJyb2tlbiByb29mLiBXaGVyZSB0aGVyZSB1c2VkIHRvIGJlIGEgcnVnIGlzIFxuYSBkYXJrIG5hcnJvdyBob2xlIGludG8gdGhlIGdyb3VuZC5cbiIsImJ1dHRvbnMiOlt7ImxhYmVsIjoic2VhcmNoIiwibXNnIjoiVGhlIHJ1ZyBoYXMgYmVlbiBtb3ZlZCB0byByZXZlYWwgYSBkYXJrIGhvbGUgaW50byB0aGUgZ3JvdW5kLiJ9LHsibGFiZWwiOiJiYWNrX2hhbmQiLCJtc2ciOiJZb3UndmUgYWxyZWFkeSByZXZlYWxlZCB0aGUgaG9sZSwgYW5kIHRoZSBydWcgaXNuJ3Qgd29ydGggdGFraW5nLlxuIn1dfX0sImdhbWVJbmZvIjogeyJ0aXRsZSI6Ik15IEdhbWUgRG9lc24ndCBIYXZlIGEgVGl0bGUiLCJhdXRob3IiOiJzcGFjZWZsb3VuZGVyIiwic3RhcnQiOiJpbnRybyJ9LCJoaWxsc2lkZSI6IHsibXNnIjoiQSBuYXJyb3cgcGF0aCB3aW5kcyB1cCBhIGxvdyBoaWxsLCBwYXNzaW5nIG5lYXIgdGhlIHJ1aW5cbm9mIGEgbGl0dGxlIGdyYXkgY290dGFnZS5cbiIsImJ1dHRvbnMiOlt7ImxhYmVsIjoid2VzdCIsIm5hdiI6ImludHJvIn0seyJsYWJlbCI6Im5vcnRoIiwibmF2IjoiY290dGFnZSJ9XX0sImludHJvIjogeyJtc2ciOiJBIGdlbnRsZSBicmVlemUgcnVzdGxlcyB0aGUgdGFsbCBicmFuY2hlcyBoaWdoIGFib3ZlLCBhIGJpdCBvZlxuY3JlZWsgYmFiYmxlcyBtZXJyaWx5IG5lYXJieS5cbiIsImJ1dHRvbnMiOlt7ImxhYmVsIjoic2VhcmNoIiwibXNnIjoiWW91IGNsb3NlIHlvdXIgZXllcyBhbmQgc25pZmYgdGhlIGNvb2wsIG1vaXN0IGFpci4ifSx7ImxhYmVsIjoibm9ydGgiLCJuYXYiOiJjYXZlTW91dGgifSx7ImxhYmVsIjoiZWFzdCIsIm5hdiI6ImhpbGxzaWRlIn1dfX0=");Z={},B=JSON.parse(e);const t=B.gameInfo.start;document.title=B.gameInfo.title,u=t,v(B[t])}();