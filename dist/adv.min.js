export const compress=e=>{const t=e,n={},o=[];let r,a,l,s="",c="",i=256;for(r=0;r<256;r+=1)n[String.fromCharCode(r)]=r;for(r=0;r<t.length;r+=1)a=t.charAt(r),l=s+a,n.hasOwnProperty(l)?s=l:(o.push(n[s]),c+=String.fromCharCode(n[s]),n[l]=i++,s=String(a));return""!==s&&(o.push(n[s]),c+=String.fromCharCode(n[s])),c};export const decompress=e=>{let t=e;const n=[];let o,r,a,l,s=[],c="",i=256;for(o=0;o<256;o+=1)n[o]=String.fromCharCode(o);if(t&&"string"==typeof t){for(o=0;o<t.length;o+=1)s.push(t[o].charCodeAt(0));t=s,s=null}for(r=String.fromCharCode(t[0]),a=r,o=1;o<t.length;o+=1){if(l=t[o],n[l])c=n[l];else{if(l!==i)return null;c=r+r.charAt(0)}a+=c,n[i++]=r+c.charAt(0),r=c}return a};import{micromark as e}from"https://esm.sh/micromark@3?bundle";import{directive as t,directiveHtml as n}from"https://esm.sh/micromark-extension-directive@3?bundle";import{gfm as o,gfmHtml as r}from"https://esm.sh/micromark-extension-gfm@3?bundle";function a(a){return a=e(a,{extensions:[t(),o()],htmlExtensions:[n({dropcap:function(e){const t=e.content.replace("<p>","").replace("</p>","");this.tag('<div class="drop-cap">'),this.tag(t),this.tag("</div>")},aside:function(e){const t=e.content.replace("<p>","").replace("</p>","");this.tag("<aside>"),this.tag(t),this.tag("</aside>")},image:function(e){let[t,n]=e.label.split(",");t=t??"",n=n??"",t=t.trim(),n=n.trim(),this.tag(`<img src="${t}" alt="${n}" class="image"></img>`)},big_icon:function(e){const t=e.label;this.tag('<span class="material-symbols-outlined iconSize">'),this.tag(t),this.tag("</span>")},kbd:function(e){const t=e.label;this.tag("<kbd>"),this.tag(t),this.tag("</kbd>")},div:function(e){const t=e.content.replace("<p>","").replace("</p>",""),n=e.label;this.tag(`<div class='${n}'>`),this.tag(t),this.tag("</div>")},icon:function(e){const t=e.label;this.tag('<span class="material-symbols-outlined">'),this.tag(t),this.tag("</span>")}}),r()]})}import l from"https://cdn.jsdelivr.net/npm/mermaid@10/dist/mermaid.esm.min.mjs";l.initialize({startOnLoad:!1,securityLevel:"loose",theme:"dark"});let s={};function c(e){let t="",n="";"."===e[0]&&(e=e.replace(".","+")),-1===e.indexOf(".")?(t=L,n=e):(t=e.split(".")[0]??void 0,n=e.split(".")[1]??void 0),"+"===e[0]&&(e=e.replace("+","."),t=t.replace("+",".")),t=M(t);for(const e in T[t])if(e.indexOf("--")>-1){const t=e.split("--")[0].trim();if(n===t){const e=`$$${t}-content`;if(T[L][e])return T[L][e]}}if("state"===n){return T[t][n]??"default"}return T[t]&&T[t][n]?T[t][n]:e}function i(e){if(-1===e.indexOf(" "))return function(e){const t=e.indexOf("!")>-1,n=(e=e.replaceAll("!","")).split(".")[0],o=e.split(".")[1];return t?!T[n][o]:!!T[n][o]}(e);const[t,n,o]=e.split(" ");if("is"===n)return c(t)===c(o);if("not"===n)return c(t)!==c(o);throw"Condition command not understood: "+e}function p(e){return!e.active||[...e.active].filter(e=>i(e)).length>0}function f(e){const t={};if(e.buttons){const o=[...e.buttons];for(const e of o){const o=e?.label??void 0,r=e?.color??"#111131",a=e?.icon??"",l=p(e),c=()=>{document.querySelector("#btns").innerHTML="",s={},e.change&&_(T,e.change),A(T);const t=M(e.go);if(t&&T[t]){e.content&&(O=e.content,O=E(O));const n=T[t];s={},L=t,H(n)}else H(),H(e)};o&&l&&(t[o]={label:(n=o,"use"===n&&(n="back_hand"),"key"===n&&(n="vpn_key"),["west","north","south","east","north_west","north_east","south_west","south_east","back_hand","door_open","candle","explosion","map","search","vpn_key","check","cancel","chat"].indexOf(n)>-1?`<span class="material-symbols-outlined iconSize">${n}</span>`:n),icon:a,color:r,action:c})}}var n;return t}const d=/<(\/?)(?:pre|code|kbd|script|math)[^>]*>/i,u=(e="",t="1")=>{var n,o,r,a,l,s=0;if("0"===(t="number"==typeof t?t.toString():t.replace(/\s/g,"")))return e;if("1"===t)n=1,o=1,r=1,a=1;else if("2"===t)n=1,o=1,r=2,a=1;else if("3"===t)n=1,o=1,r=3,a=1;else if("-1"===t)l=1;else for(let e=0;e<t.length;e++){let l=t[e];"q"===l&&(n=1),"b"===l&&(o=1),"B"===l&&(o=2),"d"===l&&(r=1),"D"===l&&(r=2),"i"===l&&(r=3),"e"===l&&(a=1),"w"===l&&(s=1)}var c=v(e),i="",p=0,f="";for(let e=0;e<c.length;e++){let t=c[e];if("tag"===t[0]){i+=t[1];let e=d.exec(t[1]);e&&(p="/"===e[1]?0:1)}else{let e=t[1],c=e.substring(e.length-1,e.length);p||(e=k(e),s&&(e=e.replace(/$quot;/g,'"')),r&&(1===r&&(e=b(e)),2===r&&(e=$(e)),3===r&&(e=x(e))),a&&(e=w(e)),o&&(e=m(e),2===o&&(e=h(e))),n&&(e="'"===e?/\S/.test(f)?"&#8217;":"&#8216;":'"'===e?/\S/.test(f)?"&#8221;":"&#8220;":g(e)),l&&(e=y(e))),f=c,i+=e}}return i},g=e=>{var t="[!\"#$%'()*+,-./:;<=>?@[\\]^_`{|}~]",n="[^\\ \\t\\r\\n\\[\\{\\(\\-]",o="&#8211;|&#8212;";return e=(e=(e=(e=(e=(e=(e=(e=(e=(e=(e=(e=(e=e.replace(new RegExp(`^'(?=${t}\\B)`),"&#8217;")).replace(new RegExp(`^"(?=${t}\\B)`),"&#8221;")).replace(/"'(?=\w)/,"&#8220;&#8216;")).replace(/'"(?=\w)/,"&#8216;&#8220;")).replace(/'(?=\d\d)/,"&#8217;")).replace(new RegExp(`(\\s|&nbsp;|--|&[mn]dash;|${o}|&#x201[34])'(?=\\w)`,"g"),"$1&#8216;")).replace(new RegExp(`(${n})'`,"g"),"$1&#8217;")).replace(new RegExp("([\\ \\t\\r\\n\\[\\{\\(\\-]?)'(?=\\s|s\\b)","g"),"$1&#8217;")).replace(/'/g,"&#8216;")).replace(new RegExp(`(\\s|&nbsp;|--|&[mn]dash;|${o}|&#x201[34])"(?=\\w)`,"g"),"$1&#8220;")).replace(new RegExp(`(${n})"`,"g"),"$1&#8221;")).replace(new RegExp('([\\ \\t\\r\\n\\[\\{\\(\\-]?)"(?=\\s)',"g"),"$1&#8221;")).replace(/"/g,"&#8220;")},m=e=>e=(e=e.replace(/``/g,"&#8220;")).replace(/''/g,"&#8221;"),h=e=>e=(e=e.replace(/`/g,"&#8216;")).replace(/'/g,"&#8217;"),b=e=>e=e.replace(/--/g,"&#8212;"),$=e=>e=(e=e.replace(/---/g,"&#8212;")).replace(/--/g,"&#8211;"),x=e=>e=(e=e.replace(/---/g,"&#8211;")).replace(/--/g,"&#8212;"),w=e=>e=(e=e.replace(/\.\.\./g,"&#8230;")).replace(/\. \. \./g,"&#8230;"),y=e=>e=(e=(e=(e=(e=(e=(e=e.replace(/&#8211;/g,"-")).replace(/&#8212;/g,"--")).replace(/&#8216;/g,"'")).replace(/&#8217;/g,"'")).replace(/&#8220;/g,'"')).replace(/&#8221;/g,'"')).replace(/&#8230;/g,"..."),k=e=>e=(e=(e=(e=(e=(e=e.replace(/\\\\/g,"&#92;")).replace(/\\"/g,"&#34;")).replace(/\\'/g,"&#39;")).replace(/\\\./g,"&#46;")).replace(/\\-/g,"&#45;")).replace(/\\`/g,"&#96;"),v=e=>{for(var t=0,n=e.length,o=[],r=/<!--[\s\S]*?-->|<\?.*?\?>|<[^>]*>/g,a=null;a=r.exec(e);){if(t<a.index){let n=["text",e.substring(t,a.index)];o.push(n)}let n=["tag",a.toString()];o.push(n),t=r.lastIndex}if(t<n){let r=["text",e.substring(t,n)];o.push(r)}return o};function C(e,t,n){const o=T[L]??{},r=`$$${e}-indexer`,a=`$$${e}-content`;let l=!1,s=o[r]??0;n.indexOf("reversed")>-1&&(t=t.reverse()),n.indexOf("shuffled")>-1&&(t=function(e){let t,n=e.length;for(;0!=n;)t=Math.floor(Math.random()*n),n--,[e[n],e[t]]=[e[t],e[n]];return e}(t)),n.indexOf("stop")>-1&&(l=!0);const c=t[s]??"";o[a]=c,s<t.length-1?l?s>-1&&(s+=1):s+=1:l||(s=0),o[r]=s}function A(e){for(const t in e){const n=e[t];for(const e in n)if(Array.isArray(n[e])&&e.indexOf("--")>-1){let[t,o]=e.split("--");if(t=t.trim(),o=o.trim(),o.indexOf("list")>-1){C(t,[...n[e]]??[],o)}}}}function S(e,t){let n="";for(const o in T[e])if(o.indexOf("--")>-1){const r=o.split("--")[0].trim();if(r.toLocaleLowerCase()===t.toLocaleLowerCase()){const t=`$$${r}-content`;n=T[e][t]??""}}return""!==n?n:(n=T[e][t],n||"")}let L="",O="",T={};function I(e){return e.charAt(0).toUpperCase()+e.slice(1)}function E(e){const t=e.matchAll(/\{\{.*\}\}/gm);if(t)for(const n of t){let t=n[0].replaceAll("{{","").replaceAll("}}","");if("."===t[0]&&(t=t.replace(".","+")),-1===t.indexOf(".")){const n=L,o=t;if(/[A-Z]/.test(o[0])){o=o[0].toLocaleLowerCase()+o.slice(1);let r=S(n,o);r=I(r),e=e.replaceAll(`{{${t}}}`,r)}else{const r=S(n,o);e=e.replaceAll(`{{${t}}}`,r)}}else{let n=t.split(".")[0].trim(),o=t.split(".")[1].trim();if("+"===t[0]&&(n=n.replace("+","."),t=t.replace("+",".")),n=M(n),/[A-Z]/.test(o[0])){o=o[0].toLocaleLowerCase()+o.slice(1);let r=S(n,o);r=E(r),r=I(r),e=e.replaceAll(`{{${t}}}`,r)}else{const r=S(n,o);r=E(r),e=e.replaceAll(`{{${t}}}`,r)}}}return e}function M(e){if(e&&"."===e[0]&&"/"===e[1]){const t=L.split("/");t.pop();return t.join("/")+(e=e.replace(".",""))}return e}function _(e,t){for(const n in t)try{t[n].constructor==Object?e[n]=_(e[n],t[n]):e[n]=t[n]}catch(o){e[n]=t[n]}return e}function H(e){if(e||(e=T[L]),!e.content&&!e.map)throw"Error: Page not implemented yet!";if(document.querySelector("#out").innerHTML="",e.start&&function(e){let t="",n="";"."===e[0]&&(e=e.replace(".","+")),-1===e.indexOf(".")?(t=L,n=e):(t=e.split(".")[0]??void 0,n=e.split(".")[1]??void 0),"+"===e[0]&&(e=e.replace("+","."),t=t.replace("+",".")),t=M(t);for(const e in T[t])if(e.indexOf("--")>-1){const o=e.split("--")[0].trim();if(n===o){const e=`$$${o}-indexer`;return void(T[t][e]=0)}}const o=`$$${n}-indexer`;T[t][o]=0}(e.start),e.content&&function(e){const t=document.querySelector("#out"),n=e?.state??"default";let o="";o="default"===n?E(e.content):e[n].content?E(e[n].content):E(e.content),""!==O&&(o=`\n\n${O}\n\n`+o,O=""),o=u(o),o=a(o),t.innerHTML=o}(e),e.map){!async function(e){e=(e="\ngraph TD\n\n\n\n\n"+e).trim();const t=document.querySelector("#out"),n=document.createElement("pre");n.className="mermaid",n.innerHTML=e,t.appendChild(n),await l.run()}(function(e){return e.split("\n").map(e=>E(e)).map(e=>e.indexOf("---")>-1?(e=e.split("---")).map(e=>e.trim()).join("---"):e).join("\n\n")}(e.map))}!function(e){const t=e?.state??"default",n=document.querySelector("#btns");if(n.innerHTML="",s={...s,...f(e)},"default"!==t){const n=f(e[t]);s={...s,...n}}const o=Object.keys(s);for(const e of o){const t=document.createElement("button");if(s[e].icon){const n=a(s[e].icon);t.innerHTML=n}t.innerHTML+=s[e].label,t.style=`background-color: ${s[e].color};`,t.onclick=s[e].action,t.alt=s[e].label,n.appendChild(t)}}(e)}function R(){const e='{"chapter0/intro": {"atmos -- shuffled list":["A cheerful little turtle plods by.",null,"The ocean churns and a good wave splashes onto the shore.",null],"content":"# Hello World\\n\\nHere is a simple footnote[^1].\\n\\n***\\n\\nThis is a break.\\n\\n{{atmos}}\\n\\nThe old ~man~ warmed his big, knobby hands by the fire. \\n\\n[^1]: My reference.\\n","buttons":[{"label":"check","content":"Add some content here to start working on your game!","go":"chapter1/test"},{"label":"walk","icon":"::big_icon[directions_walk]","content":"Walk south"},{"label":"search","content":"{{atmos}}\\n"},{"label":"north","content":"{{atmos}}\\n","go":"./silkhorn"}]},"chapter0/silkhorn": {"content":"Blooooo\\n","buttons":[{"label":"check","map":"Cave --- Town\\nTown --- Library\\nTown --- Well\\n\\n{{mapNode}}\\n"},{"label":"Special edition","content":":image[assets/kraid.webp, Samus graphic here]\\n\\nNo noodles please.\\n"}]},"chapter1/test": {"content":"This is a test of the multi-chapter system.\\n","foobar -- stop list":["one","two","three","four","five","six"],"buttons":[{"label":"This is only","content":"Complete! {{foobar}}\\n"},{"label":"Hello number two","content":"It works!","change":{"chapter0/silkhorn":{"mapNode":"passage[Secret Passage] --- Library\\n"}},"active":["foobar is two"]},{"label":"Reset","content":"It works!","start":"foobar"},{"label":"A test","go":"chapter0/silkhorn"}]},"gameInfo": {"title":"Adventure","author":"spaceflounder","email":"spaceflounder@hotmail.com","genre":"adventure","start":"chapter0/intro","debug":true,"IFID":"B9CB0924-5538-D237-F7F3-C80A27F9BF10","import":"@import url(\'https://fonts.googleapis.com/css2?family=Cormorant&family=Montserrat:ital,wght@0,100;0,200;0,300;0,400;0,500;0,600;0,700;0,800;0,900;1,100;1,200;1,300;1,400;1,500;1,600;1,700;1,800;1,900&display=swap\');\\n","header font":"Cormorant, Times New Roman","font":"Montserrat, sans-serif","background":"#020213"},"debug": null}';s={};try{T=JSON.parse(e)}catch{throw t=e,document.getElementById("out").append(t),e}var t;if(!!T.gameInfo.debug){const e=T.debug??{};_(T,e)}const n=T.gameInfo.import;if(n){const e=document.createElement("style");e.innerHTML=n,document.head.appendChild(e)}const o=document.createElement("style"),r=T.gameInfo.highlight??"rgba(255, 255, 255, 0.9)",a=T.gameInfo.foreground??"rgba(255, 255, 255, 0.7)",l=T.gameInfo.background??"#0d0d0d";o.innerHTML=`\n    :root {\n        background-color: ${l};\n        color: ${a};\n        font-family: ${T.gameInfo.font};\n    }\n    h1, h2, h3, h4 {\n        font-family: ${T.gameInfo["header font"]};\n        color: ${r};\n    }\n    a {\n        color: ${r};\n        font-family: ${T.gameInfo["header font"]};\n    }\n    `,document.head.appendChild(o);const c=T.gameInfo.start;document.title=T.gameInfo.title,L=c,A(T),H(T[c])}R();