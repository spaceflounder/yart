export const compress=e=>{const t=btoa(e),n={},r=[];let o,c,i,l="",s="",a=256;for(o=0;o<256;o+=1)n[String.fromCharCode(o)]=o;for(o=0;o<t.length;o+=1)c=t.charAt(o),i=l+c,n.hasOwnProperty(i)?l=i:(r.push(n[l]),s+=String.fromCharCode(n[l]),n[i]=a++,l=String(c));return""!==l&&(r.push(n[l]),s+=String.fromCharCode(n[l])),s};export const decompress=e=>{let t=e;const n=[];let r,o,c,i,l=[],s="",a=256;for(r=0;r<256;r+=1)n[r]=String.fromCharCode(r);if(t&&"string"==typeof t){for(r=0;r<t.length;r+=1)l.push(t[r].charCodeAt(0));t=l,l=null}for(o=String.fromCharCode(t[0]),c=o,r=1;r<t.length;r+=1){if(i=t[r],n[i])s=n[i];else{if(i!==a)return null;s=o+o.charAt(0)}c+=s,n[a++]=o+s.charAt(0),o=s}return atob(c)};import{micromark as e}from"https://esm.sh/micromark@3?bundle";import{directive as t,directiveHtml as n}from"https://esm.sh/micromark-extension-directive@3?bundle";import{gfm as r,gfmHtml as o}from"https://esm.sh/micromark-extension-gfm@3?bundle";import c from"https://cdn.jsdelivr.net/npm/mermaid@10/dist/mermaid.esm.min.mjs";c.initialize({startOnLoad:!1,securityLevel:"loose",theme:"dark"});const i=/<(\/?)(?:pre|code|kbd|script|math)[^>]*>/i,l=(e="",t="1")=>{var n,r,o,c,l,x=0;if("0"===(t="number"==typeof t?t.toString():t.replace(/\s/g,"")))return e;if("1"===t)n=1,r=1,o=1,c=1;else if("2"===t)n=1,r=1,o=2,c=1;else if("3"===t)n=1,r=1,o=3,c=1;else if("-1"===t)l=1;else for(let e=0;e<t.length;e++){let i=t[e];"q"===i&&(n=1),"b"===i&&(r=1),"B"===i&&(r=2),"d"===i&&(o=1),"D"===i&&(o=2),"i"===i&&(o=3),"e"===i&&(c=1),"w"===i&&(x=1)}var $=b(e),y="",w=0,O="";for(let e=0;e<$.length;e++){let t=$[e];if("tag"===t[0]){y+=t[1];let e=i.exec(t[1]);e&&(w="/"===e[1]?0:1)}else{let e=t[1],i=e.substring(e.length-1,e.length);w||(e=h(e),x&&(e=e.replace(/$quot;/g,'"')),o&&(1===o&&(e=f(e)),2===o&&(e=d(e)),3===o&&(e=u(e))),c&&(e=g(e)),r&&(e=a(e),2===r&&(e=p(e))),n&&(e="'"===e?/\S/.test(O)?"&#8217;":"&#8216;":'"'===e?/\S/.test(O)?"&#8221;":"&#8220;":s(e)),l&&(e=m(e))),O=i,y+=e}}return y},s=e=>{var t="[!\"#$%'()*+,-./:;<=>?@[\\]^_`{|}~]",n="[^\\ \\t\\r\\n\\[\\{\\(\\-]",r="&#8211;|&#8212;";return e=(e=(e=(e=(e=(e=(e=(e=(e=(e=(e=(e=(e=e.replace(new RegExp(`^'(?=${t}\\B)`),"&#8217;")).replace(new RegExp(`^"(?=${t}\\B)`),"&#8221;")).replace(/"'(?=\w)/,"&#8220;&#8216;")).replace(/'"(?=\w)/,"&#8216;&#8220;")).replace(/'(?=\d\d)/,"&#8217;")).replace(new RegExp(`(\\s|&nbsp;|--|&[mn]dash;|${r}|&#x201[34])'(?=\\w)`,"g"),"$1&#8216;")).replace(new RegExp(`(${n})'`,"g"),"$1&#8217;")).replace(new RegExp("([\\ \\t\\r\\n\\[\\{\\(\\-]?)'(?=\\s|s\\b)","g"),"$1&#8217;")).replace(/'/g,"&#8216;")).replace(new RegExp(`(\\s|&nbsp;|--|&[mn]dash;|${r}|&#x201[34])"(?=\\w)`,"g"),"$1&#8220;")).replace(new RegExp(`(${n})"`,"g"),"$1&#8221;")).replace(new RegExp('([\\ \\t\\r\\n\\[\\{\\(\\-]?)"(?=\\s)',"g"),"$1&#8221;")).replace(/"/g,"&#8220;")},a=e=>e=(e=e.replace(/``/g,"&#8220;")).replace(/''/g,"&#8221;"),p=e=>e=(e=e.replace(/`/g,"&#8216;")).replace(/'/g,"&#8217;"),f=e=>e=e.replace(/--/g,"&#8212;"),d=e=>e=(e=e.replace(/---/g,"&#8212;")).replace(/--/g,"&#8211;"),u=e=>e=(e=e.replace(/---/g,"&#8211;")).replace(/--/g,"&#8212;"),g=e=>e=(e=e.replace(/\.\.\./g,"&#8230;")).replace(/\. \. \./g,"&#8230;"),m=e=>e=(e=(e=(e=(e=(e=(e=e.replace(/&#8211;/g,"-")).replace(/&#8212;/g,"--")).replace(/&#8216;/g,"'")).replace(/&#8217;/g,"'")).replace(/&#8220;/g,'"')).replace(/&#8221;/g,'"')).replace(/&#8230;/g,"..."),h=e=>e=(e=(e=(e=(e=(e=e.replace(/\\\\/g,"&#92;")).replace(/\\"/g,"&#34;")).replace(/\\'/g,"&#39;")).replace(/\\\./g,"&#46;")).replace(/\\-/g,"&#45;")).replace(/\\`/g,"&#96;"),b=e=>{for(var t=0,n=e.length,r=[],o=/<!--[\s\S]*?-->|<\?.*?\?>|<[^>]*>/g,c=null;c=o.exec(e);){if(t<c.index){let n=["text",e.substring(t,c.index)];r.push(n)}let n=["tag",c.toString()];r.push(n),t=o.lastIndex}if(t<n){let o=["text",e.substring(t,n)];r.push(o)}return r};let x="",$="",y={},w={};function O(e){return e.charAt(0).toUpperCase()+e.slice(1)}function v(e,t){let n="";for(const r in w[e])if(r.indexOf("--")>-1){const o=r.split("--")[0].trim();if(o.toLocaleLowerCase()===t.toLocaleLowerCase()){const t=`$$${o}-content`;n=w[e][t]??""}}return""!==n?n:(n=w[e][t],n||"!value not found!")}function C(e){const t=e.matchAll(/\{\{.*\}\}/gm);if(t)for(const n of t){let t=n[0].replaceAll("{{","").replaceAll("}}","");if("."===t[0]&&(t=t.replace(".","+")),-1===t.indexOf(".")){const n=x,r=t;if(/[A-Z]/.test(r[0])){r=r[0].toLocaleLowerCase()+r.slice(1);let o=v(n,r);o=O(o),e=e.replaceAll(`{{${t}}}`,o)}else{const o=v(n,r);e=e.replaceAll(`{{${t}}}`,o)}}else{let n=t.split(".")[0].trim(),r=t.split(".")[1].trim();if("+"===t[0]&&(n=n.replace("+","."),t=t.replace("+",".")),n=A(n),/[A-Z]/.test(r[0])){r=r[0].toLocaleLowerCase()+r.slice(1);let o=v(n,r);o=O(o),e=e.replaceAll(`{{${t}}}`,o)}else{const o=v(n,r);e=e.replaceAll(`{{${t}}}`,o)}}}return e}function S(c){const i=document.querySelector("#out"),s=c?.state??"default";let a="";a="default"===s?C(c.content):c[s].content?C(c[s].content):C(c.content),""!==$&&(a=`\n\n${$}\n\n`+a,$=""),a=l(a),a=function(c){return e(c,{extensions:[t(),r()],htmlExtensions:[n({dropcap:function(e){const t=e.content.replace("<p>","").replace("</p>","");this.tag('<div class="drop-cap">'),this.tag(t),this.tag("</div>")},aside:function(e){const t=e.content.replace("<p>","").replace("</p>","");this.tag("<aside>"),this.tag(t),this.tag("</aside>")},image:function(e){let[t,n]=e.label.split(",");t=t??"",n=n??"",t=t.trim(),n=n.trim(),this.tag(`<img src="${t}" alt="${n}" class="image"></img>`)},kbd:function(e){const t=e.label;this.tag("<kbd>"),this.tag(t),this.tag("</kbd>")},div:function(e){const t=e.content.replace("<p>","").replace("</p>",""),n=e.label;this.tag(`<div class='${n}'>`),this.tag(t),this.tag("</div>")},icon:function(e){const t=e.label;this.tag('<span class="material-symbols-outlined">'),this.tag(t),this.tag("</span>")}}),o()]})}(a),i.innerHTML=a}function L(e){return!e.active||[...e.active].filter(e=>function(e){if(-1===e.indexOf(" "))return function(e){const t=e.indexOf("!")>-1,n=(e=e.replaceAll("!","")).split(".")[0],r=e.split(".")[1];if(t)return!w[n][r];if(w[n][r])return!0;return!1}(e);const[t,n,r]=e.split(" ");if("is"===n)return B(t)===B(r);if("not"===n)return B(t)!==B(r);throw"Condition command not understood: "+e}(e)).length>0}function k(e,t,n){const r=w[x]??{},o=`$$${e}-indexer`,c=`$$${e}-content`;let i=!1,l=r[o]??0;n.indexOf("reversed")>-1&&(t=t.reverse()),n.indexOf("shuffled")>-1&&(t=function(e){let t,n=e.length;for(;0!=n;)t=Math.floor(Math.random()*n),n--,[e[n],e[t]]=[e[t],e[n]];return e}(t)),n.indexOf("stop")>-1&&(i=!0);const s=t[l]??"";r[c]=s,l<t.length-1?i?l>-1&&(l+=1):l+=1:i||(l=0),r[o]=l}function I(e){for(const t in e){const n=e[t];for(const e in n)if(Array.isArray(n[e])&&e.indexOf("--")>-1){let[t,r]=e.split("--");if(t=t.trim(),r=r.trim(),r.indexOf("list")>-1){k(t,[...n[e]]??[],r)}}}}function A(e){if(e&&"."===e[0]&&"/"===e[1]){const t=x.split("/");t.pop();return t.join("/")+(e=e.replace(".",""))}return e}function E(e){const t={};if(e.buttons){const r=[...e.buttons];for(const e of r){const r=e?.label??void 0,o=e?.color??"#111131",c=L(e),i=()=>{document.querySelector("#btns").innerHTML="",y={},e.change&&M(w,e.change),I(w);const t=A(e.go);if(t&&w[t]){const n=w[t];y={},x=t,e.content&&($=e.content),J(n)}else J(),J(e)};r&&c&&(t[r]={label:(n=r,"use"===n&&(n="back_hand"),["west","north","south","east","north_west","north_east","south_west","south_east","back_hand","search","check","cancel","chat"].indexOf(n)>-1?`<span class="material-symbols-outlined iconSize">${n}</span>`:n),color:o,action:i})}}var n;return t}function M(e,t){for(const n in t)try{t[n].constructor==Object?e[n]=M(e[n],t[n]):e[n]=t[n]}catch(r){e[n]=t[n]}return e}function B(e){let t="",n="";"."===e[0]&&(e=e.replace(".","+")),-1===e.indexOf(".")?(t=x,n=e):(t=e.split(".")[0]??void 0,n=e.split(".")[1]??void 0),"+"===e[0]&&(e=e.replace("+","."),t=t.replace("+",".")),t=A(t);for(const e in w[t])if(e.indexOf("--")>-1){const t=e.split("--")[0].trim();if(n===t){const e=`$$${t}-content`;if(w[x][e])return w[x][e]}}if("state"===n){return w[t][n]??"default"}return w[t]&&w[t][n]?w[t][n]:e}function R(e){const t=e?.state??"default",n=document.querySelector("#btns");if(n.innerHTML="",y={...y,...E(e)},"default"!==t){const n=E(e[t]);y={...y,...n}}const r=function(){const e=Object.keys(y);let t=[];const n=["check","cancel","use","search","chat"],r=["north_west","north","north_east","east","south_east","south","south_west","west"];return t=[...n.filter(t=>e.indexOf(t)>-1)],t=[...t,...e.filter(e=>-1===n.indexOf(e)&&-1===r.indexOf(e))],t=[...t,...r.filter(t=>e.indexOf(t)>-1)],t}();for(const e of r){const t=document.createElement("button");t.innerHTML=y[e].label,t.style=`background-color: ${y[e].color};`,t.onclick=y[e].action,t.alt=y[e].label,n.appendChild(t)}}function J(e){if(e||(e=w[x]),!e.content&&!e.map)throw"Error: Page not implemented yet!";document.querySelector("#out").innerHTML="",e.start&&function(e){let t="",n="";"."===e[0]&&(e=e.replace(".","+")),-1===e.indexOf(".")?(t=x,n=e):(t=e.split(".")[0]??void 0,n=e.split(".")[1]??void 0),"+"===e[0]&&(e=e.replace("+","."),t=t.replace("+",".")),t=A(t);for(const e in w[t])if(e.indexOf("--")>-1){console.log(n);const r=e.split("--")[0].trim();if(n===r){const e=`$$${r}-indexer`;return void(w[t][e]=0)}}const r=`$$${n}-indexer`;w[t][r]=0}(e.start),e.content&&S(e),e.map&&async function(e){e="\ngraph TD\n"+e.split("\n").map(e=>e.trim()).join("\n");const t=document.querySelector("#out"),n=document.createElement("pre");n.className="mermaid",n.innerHTML=e,t.appendChild(n),await c.run()}(e.map),R(e)}function W(){const e=decompress("eyJjaGFwdGVyMC9pbnRybyI6IHsiY29uĈVğCĖIiMgSĉsbG8gVĝēGRcblxuĩĊZSBpcyBhĘNďXBsļBmbĝ0bm90ZVteMV0uXG5ĵioqKķśŝUĄlzIGũūEgYnJlYWsťŞĶRoŊvĬQgfm1hĐ4gd2FēWVkūhĿŁiaWcsūtuōJieĽoŵ5kŀBƞĽ0ĄUgZmlyļƇŜŹlŖŘ0ėE15ĘųƭĻW5jļŹiIƘmJ1dHRžnMiOƵ7ImxhYmVƘjoě2hŴ2ĚLCĂō5œǁ0IǞiQWRƏHNžWƫĜĞĠĢBżXųĘǎń0YȀǭHdvcmtďmcgōƇeW91ciBnŵ1lISǇǖȊǮǟĜhhcǍlcjEvĠzdǧ9LęiĬFiZWwǒiJƛ3JƩģǈȤǯLi9zƕxrĄ9ēɀ9XX0ǈNơŇœXIwL3ŅĬtobɃuȥgĀǨ2ǪȼǪȥǰǗžĝž1ĸĥȾűřĈĞŀĖW3ĚȹȻȽȿĂĄVăĕǈƄcģėkNhdmƫLS0tIFǎƉƴʟ2ƇʙʛIExpűJȩnȬźȰʣgʥʜFdlĬxşJȵȷʅȼȾOɀTcĉăWFƘĉkaXRďʣiǦɭɯǬɲOƮtŵʷWƊzc2řŀ9rȌFpZC53ȼJɠCBTȝȘŁn˦wŨjƐȬǛdƳĵk5vū̂ōRŉXħ˅xŴXNlLŤInǋfSɻǡȩȫȭȯȱȳĤȷǺğĉĢĤlŻˍħ̩ŰƨZ̎ǭG9mȂżĽtdWxƩS1ăąćĉĕǵŞ3RʸSǅȢmZɵʬșAtʙBȲ̱wūʩc3QǒlʄɮȟiȾǌȤ͡iĈhưǸ˒ǧŌ3ĊɺȻƮ2ļȢnŅeǧd˓ͦˎŏɮŪjďɬsŵųbʑI̧o̫̫ǩsƟ͊ǶĐ͆Đ͛˂JDō1wĬřļůe3tŌĝěȀ9fVɹnɘ΃΅ʸΈkǢʹ̃ŝ1bWųșB0Ɖ8ͫ˔ǫɱǯSXƀƉɒa3MŃͥŵNƩXZȟ΁bǖ͌ƜȩȚƒμξiɖέā΄ιΰ̦κˡǭώĝ̣ġ̟ʒlȈȊȌtŪȡƘͶȅȇɲƭ9vǚƋ̓ϡJϣΆαů̞Ɇȣ̃ǯȧ͆̚ȭAȋ2͝aǡȋm4iΩ1ȵǧȜWȞSǁŌĕėȷĈϰĬUʈBZHϓΓȘʗπʕˎɦ3ĥΗ˟ąǃWZīͮuŹͰȼƄƕˁɀлFнпɧġуĊQGhȰGчȽuǺʜͥZˡuȌЫΗhЮаđвЫ˓͔ƋϮǖɚȆμ̮ɟLГğHJ̃ѝĉͦƖǒđy̸UƘklGSUΖɀCOUNCMDkyҎ01NTM4L҈ċ˟tRjĈMy1DODBBMҡGҌJGMTAπņBȋn҉JAƕΛɧɄĘĊ·gnaǍ0ȪM6Ly̲ǩӇy5nō9ӒĉȩŬzLmΒS9j͙ңPͳƅW͝eTҥҾtҾƅҸ͋mFtɎ5PU1ǏRz̮JyȆQ6ˍRƅCxˬǡ0QDAsұAwOzԋҫԎԐԒԑԏԑsNԊԘԋҗԔԙNjԠԞԗԕsҧԤԨҲԘEԌԬԐԮԓԭԌԦzԮԛԠԸ԰ԷԚԣԴNԶԮԩԴOԬJmˏ͙ňȆk9͙dȩCcpOɸɩͥʊѤфGϘҸʈΙɃӫɃӭQƘʞďƍŪE5ldŁSΚƅǆǈ՞ҹNӎˠĊ˦0Ǧ͓Ƣә̎˼l̳ώӰă2կятΈĦwԓċҘК̗Ȼѻ̸ș˂Bğ̹sfQ==");y={};try{w=JSON.parse(e)}catch{throw t=e,document.getElementById("out").append(t),e}var t;if(!!w.gameInfo.debug){const e=w.debug??{};M(w,e)}const n=w.gameInfo.import;if(n){const e=document.createElement("style");e.innerHTML=n,document.head.appendChild(e)}const r=document.createElement("style"),o=w.gameInfo.highlight??"rgba(255, 255, 255, 0.9)",c=w.gameInfo.foreground??"rgba(255, 255, 255, 0.7)",i=w.gameInfo.background??"#0d0d0d";r.innerHTML=`\n    :root {\n        background-color: ${i};\n        color: ${c};\n        font-family: ${w.gameInfo.font};\n    }\n    h1, h2, h3, h4 {\n        font-family: ${w.gameInfo["header font"]};\n        color: ${o};\n    }\n    a {\n        color: ${o};\n        font-family: ${w.gameInfo["header font"]};\n    }\n    `,document.head.appendChild(r);const l=w.gameInfo.start;document.title=w.gameInfo.title,x=l,I(w),J(w[l])}W();