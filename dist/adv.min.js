export const compress=e=>{const t=e,n={},o=[];let r,a,l,c="",s="",i=256;for(r=0;r<256;r+=1)n[String.fromCharCode(r)]=r;for(r=0;r<t.length;r+=1)a=t.charAt(r),l=c+a,n.hasOwnProperty(l)?c=l:(o.push(n[c]),s+=String.fromCharCode(n[c]),n[l]=i++,c=String(a));return""!==c&&(o.push(n[c]),s+=String.fromCharCode(n[c])),s};export const decompress=e=>{let t=e;const n=[];let o,r,a,l,c=[],s="",i=256;for(o=0;o<256;o+=1)n[o]=String.fromCharCode(o);if(t&&"string"==typeof t){for(o=0;o<t.length;o+=1)c.push(t[o].charCodeAt(0));t=c,c=null}for(r=String.fromCharCode(t[0]),a=r,o=1;o<t.length;o+=1){if(l=t[o],n[l])s=n[l];else{if(l!==i)return null;s=r+r.charAt(0)}a+=s,n[i++]=r+s.charAt(0),r=s}return a};import{micromark as e}from"https://esm.sh/micromark@3?bundle";import{directive as t,directiveHtml as n}from"https://esm.sh/micromark-extension-directive@3?bundle";import{gfm as o,gfmHtml as r}from"https://esm.sh/micromark-extension-gfm@3?bundle";function a(a){return a=e(a,{extensions:[t(),o()],htmlExtensions:[n({dropcap:function(e){const t=e.content.replace("<p>","").replace("</p>","");this.tag('<div class="drop-cap">'),this.tag(t),this.tag("</div>")},aside:function(e){const t=e.content.replace("<p>","").replace("</p>","");this.tag("<aside>"),this.tag(t),this.tag("</aside>")},image:function(e){let[t,n]=e.label.split(",");t=t??"",n=n??"",t=t.trim(),n=n.trim(),this.tag(`<img src="${t}" alt="${n}" class="image"></img>`)},big_icon:function(e){const t=e.label;this.tag('<span class="material-symbols-outlined iconSize">'),this.tag(t),this.tag("</span>")},kbd:function(e){const t=e.label;this.tag("<kbd>"),this.tag(t),this.tag("</kbd>")},div:function(e){const t=e.content.replace("<p>","").replace("</p>",""),n=e.label;this.tag(`<div class='${n}'>`),this.tag(t),this.tag("</div>")},icon:function(e){const t=e.label;this.tag('<span class="material-symbols-outlined">'),this.tag(t),this.tag("</span>")}}),r()]})}import l from"https://cdn.jsdelivr.net/npm/mermaid@10/dist/mermaid.esm.min.mjs";l.initialize({startOnLoad:!1,securityLevel:"loose",theme:"dark"});import{P as c}from"https://cdn.jsdelivr.net/npm/mermaid@10/dist/mermaid-d06ecb0d.js";let s={};function i(e){let t="",n="";"."===e[0]&&(e=e.replace(".","+")),-1===e.indexOf(".")?(t=O,n=e):(t=e.split(".")[0]??void 0,n=e.split(".")[1]??void 0),"+"===e[0]&&(e=e.replace("+","."),t=t.replace("+",".")),t=_(t);for(const e in I[t])if(e.indexOf("--")>-1){const t=e.split("--")[0].trim();if(n===t){const e=`$$${t}-content`;if(I[O][e])return I[O][e]}}if("state"===n){return I[t][n]??"default"}return I[t]&&I[t][n]?I[t][n]:e}function p(e){const t=[...e.matchAll(/\((.*)\) is \((.*)\)/gm)][0],n=[...e.matchAll(/\((.*)\) not \((.*)\)/gm)][0];if(t&&t.length>0){const e=t[1],n=t[2];return i(e)===i(n)}if(n&&n.length>0){const e=n[1],t=n[2];return i(e)!==i(t)}try{return function(e){const t=[...e.matchAll(/\((.*)\)/g)][0][1];if(!t)throw"Condition not understood: "+e;const n=0===(e=t).indexOf("!"),o=(e=e.replaceAll("!","")).split(".")[0],r=e.split(".")[1];return n?!I[o][r]:!!I[o][r]}(e)}catch{throw"Condition not understood: "+e}}function f(e){return!e.active||[...e.active].filter(e=>p(e)).length>0}function d(e){const t={};if(e.buttons){const o=[...e.buttons];for(const e of o){const o=e?.label??void 0,r=e?.color??"#111131",a=e?.icon??"",l=f(e),c=()=>{document.querySelector("#btns").innerHTML="",s={},e.change&&H(I,e.change),S(I);const t=_(e.go);if(t&&I[t]){e.content&&(T=e.content,T=M(T));const n=I[t];s={},O=t,R(n)}else R(),R(e)};o&&l&&(t[o]={label:(n=o,"use"===n&&(n="back_hand"),"key"===n&&(n="vpn_key"),["west","north","south","east","north_west","north_east","south_west","south_east","back_hand","door_open","candle","explosion","map","search","vpn_key","check","cancel","chat"].indexOf(n)>-1?`<span class="material-symbols-outlined iconSize">${n}</span>`:n),icon:a,color:r,action:c})}}var n;return t}const m=/<(\/?)(?:pre|code|kbd|script|math)[^>]*>/i,g=(e="",t="1")=>{var n,o,r,a,l,c=0;if("0"===(t="number"==typeof t?t.toString():t.replace(/\s/g,"")))return e;if("1"===t)n=1,o=1,r=1,a=1;else if("2"===t)n=1,o=1,r=2,a=1;else if("3"===t)n=1,o=1,r=3,a=1;else if("-1"===t)l=1;else for(let e=0;e<t.length;e++){let l=t[e];"q"===l&&(n=1),"b"===l&&(o=1),"B"===l&&(o=2),"d"===l&&(r=1),"D"===l&&(r=2),"i"===l&&(r=3),"e"===l&&(a=1),"w"===l&&(c=1)}var s=C(e),i="",p=0,f="";for(let e=0;e<s.length;e++){let t=s[e];if("tag"===t[0]){i+=t[1];let e=m.exec(t[1]);e&&(p="/"===e[1]?0:1)}else{let e=t[1],s=e.substring(e.length-1,e.length);p||(e=v(e),c&&(e=e.replace(/$quot;/g,'"')),r&&(1===r&&(e=$(e)),2===r&&(e=w(e)),3===r&&(e=x(e))),a&&(e=y(e)),o&&(e=u(e),2===o&&(e=b(e))),n&&(e="'"===e?/\S/.test(f)?"&#8217;":"&#8216;":'"'===e?/\S/.test(f)?"&#8221;":"&#8220;":h(e)),l&&(e=k(e))),f=s,i+=e}}return i},h=e=>{var t="[!\"#$%'()*+,-./:;<=>?@[\\]^_`{|}~]",n="[^\\ \\t\\r\\n\\[\\{\\(\\-]",o="&#8211;|&#8212;";return e=(e=(e=(e=(e=(e=(e=(e=(e=(e=(e=(e=(e=e.replace(new RegExp(`^'(?=${t}\\B)`),"&#8217;")).replace(new RegExp(`^"(?=${t}\\B)`),"&#8221;")).replace(/"'(?=\w)/,"&#8220;&#8216;")).replace(/'"(?=\w)/,"&#8216;&#8220;")).replace(/'(?=\d\d)/,"&#8217;")).replace(new RegExp(`(\\s|&nbsp;|--|&[mn]dash;|${o}|&#x201[34])'(?=\\w)`,"g"),"$1&#8216;")).replace(new RegExp(`(${n})'`,"g"),"$1&#8217;")).replace(new RegExp("([\\ \\t\\r\\n\\[\\{\\(\\-]?)'(?=\\s|s\\b)","g"),"$1&#8217;")).replace(/'/g,"&#8216;")).replace(new RegExp(`(\\s|&nbsp;|--|&[mn]dash;|${o}|&#x201[34])"(?=\\w)`,"g"),"$1&#8220;")).replace(new RegExp(`(${n})"`,"g"),"$1&#8221;")).replace(new RegExp('([\\ \\t\\r\\n\\[\\{\\(\\-]?)"(?=\\s)',"g"),"$1&#8221;")).replace(/"/g,"&#8220;")},u=e=>e=(e=e.replace(/``/g,"&#8220;")).replace(/''/g,"&#8221;"),b=e=>e=(e=e.replace(/`/g,"&#8216;")).replace(/'/g,"&#8217;"),$=e=>e=e.replace(/--/g,"&#8212;"),w=e=>e=(e=e.replace(/---/g,"&#8212;")).replace(/--/g,"&#8211;"),x=e=>e=(e=e.replace(/---/g,"&#8211;")).replace(/--/g,"&#8212;"),y=e=>e=(e=e.replace(/\.\.\./g,"&#8230;")).replace(/\. \. \./g,"&#8230;"),k=e=>e=(e=(e=(e=(e=(e=(e=e.replace(/&#8211;/g,"-")).replace(/&#8212;/g,"--")).replace(/&#8216;/g,"'")).replace(/&#8217;/g,"'")).replace(/&#8220;/g,'"')).replace(/&#8221;/g,'"')).replace(/&#8230;/g,"..."),v=e=>e=(e=(e=(e=(e=(e=e.replace(/\\\\/g,"&#92;")).replace(/\\"/g,"&#34;")).replace(/\\'/g,"&#39;")).replace(/\\\./g,"&#46;")).replace(/\\-/g,"&#45;")).replace(/\\`/g,"&#96;"),C=e=>{for(var t=0,n=e.length,o=[],r=/<!--[\s\S]*?-->|<\?.*?\?>|<[^>]*>/g,a=null;a=r.exec(e);){if(t<a.index){let n=["text",e.substring(t,a.index)];o.push(n)}let n=["tag",a.toString()];o.push(n),t=r.lastIndex}if(t<n){let r=["text",e.substring(t,n)];o.push(r)}return o};function A(e,t,n){const o=I[O]??{},r=`$$${e}-indexer`,a=`$$${e}-content`;let l=!1,c=o[r]??0;n.indexOf("reversed")>-1&&(t=t.reverse()),n.indexOf("shuffled")>-1&&(t=function(e){let t,n=e.length;for(;0!=n;)t=Math.floor(Math.random()*n),n--,[e[n],e[t]]=[e[t],e[n]];return e}(t)),n.indexOf("stop")>-1&&(l=!0);const s=t[c]??"";o[a]=s,c<t.length-1?l?c>-1&&(c+=1):c+=1:l||(c=0),o[r]=c}function S(e){for(const t in e){const n=e[t];for(const e in n)if(Array.isArray(n[e])&&e.indexOf("--")>-1){let[t,o]=e.split("--");if(t=t.trim(),o=o.trim(),o.indexOf("list")>-1){A(t,[...n[e]]??[],o)}}}}function L(e,t){let n="";for(const o in I[e])if(o.indexOf("--")>-1){const r=o.split("--")[0].trim();if(r.toLocaleLowerCase()===t.toLocaleLowerCase()){const t=`$$${r}-content`;n=I[e][t]??""}}return""!==n?n:(n=I[e][t],n||"")}let O="",T="",I={};function E(e){return e.charAt(0).toUpperCase()+e.slice(1)}function M(e){const t=e.matchAll(/\{\{.*\}\}/gm);if(t)for(const n of t){let t=n[0].replaceAll("{{","").replaceAll("}}","");if("."===t[0]&&(t=t.replace(".","+")),-1===t.indexOf(".")){const n=O,o=t;if(/[A-Z]/.test(o[0])){o=o[0].toLocaleLowerCase()+o.slice(1);let r=L(n,o);r=E(r),e=e.replaceAll(`{{${t}}}`,r)}else{const r=L(n,o);e=e.replaceAll(`{{${t}}}`,r)}}else{let n=t.split(".")[0].trim(),o=t.split(".")[1].trim();if("+"===t[0]&&(n=n.replace("+","."),t=t.replace("+",".")),n=_(n),/[A-Z]/.test(o[0])){o=o[0].toLocaleLowerCase()+o.slice(1);let r=L(n,o);r=M(r),r=E(r),e=e.replaceAll(`{{${t}}}`,r)}else{const r=L(n,o);r=M(r),e=e.replaceAll(`{{${t}}}`,r)}}}return e}function _(e){if(e&&"."===e[0]&&"/"===e[1]){const t=O.split("/");t.pop();return t.join("/")+(e=e.replace(".",""))}return e}function H(e,t){for(const n in t)try{t[n].constructor==Object?e[n]=H(e[n],t[n]):e[n]=t[n]}catch(o){e[n]=t[n]}return e}function R(e){if(e||(e=I[O]),!e.content&&!e.map)throw"Error: Page not implemented yet!";if(document.querySelector("#out").innerHTML="",e.start&&function(e){let t="",n="";"."===e[0]&&(e=e.replace(".","+")),-1===e.indexOf(".")?(t=O,n=e):(t=e.split(".")[0]??void 0,n=e.split(".")[1]??void 0),"+"===e[0]&&(e=e.replace("+","."),t=t.replace("+",".")),t=_(t);for(const e in I[t])if(e.indexOf("--")>-1){const o=e.split("--")[0].trim();if(n===o){const e=`$$${o}-indexer`;return void(I[t][e]=0)}}const o=`$$${n}-indexer`;I[t][o]=0}(e.start),e.content&&function(e){const t=document.querySelector("#out"),n=e?.state??"default";let o="";o="default"===n?M(e.content):e[n].content?M(e[n].content):M(e.content),""!==T&&(o=`\n\n${T}\n\n`+o,T=""),o=g(o),o=a(o),t.innerHTML=o}(e),e.map){!async function(e){e=(e="\ngraph TD\n\n\n\n\n"+e).trim();const t=document.querySelector("#out"),n=document.createElement("pre");n.className="mermaid",n.innerHTML=e,t.appendChild(n),await l.run()}(function(e){return e.split("\n").map(e=>M(e)).map(e=>e.indexOf("---")>-1?(e=e.split("---")).map(e=>e.trim()).join("---"):e).join("\n\n")}(e.map))}!function(e){const t=e?.state??"default",n=document.querySelector("#btns");if(n.innerHTML="",s={...s,...d(e)},"default"!==t){const n=d(e[t]);s={...s,...n}}const o=Object.keys(s);for(const e of o){const t=document.createElement("button");if(s[e].icon){const n=a(s[e].icon);t.innerHTML=n}t.innerHTML+=s[e].label,t.style=`background-color: ${s[e].color};`,t.onclick=s[e].action,t.alt=s[e].label,n.appendChild(t)}}(e)}function j(){const e='{"chapter0/intro": {"atmos -- shuffled list":["A cheerful little turtle plods by.",null,"The ocean churns and a good wave splashes onto the shore.",null],"content":"# Hello World\\n\\nHere is a simple footnote[^1].\\n\\n***\\n\\nThis is a break.\\n\\n{{atmos}}\\n\\nThe old ~man~ warmed his big, knobby hands by the fire. \\n\\n[^1]: My reference.\\n","buttons":[{"label":"check","content":"Add some content here to start working on your game!","go":"chapter1/test"},{"label":"walk","icon":"::big_icon[directions_walk]","content":"Walk south"},{"label":"search","active":["(chapter1/test.scorge)"],"content":"{{atmos}}\\n"},{"label":"north","content":"{{atmos}}\\n","go":"./silkhorn"}]},"chapter0/silkhorn": {"content":"Blooooo\\n","buttons":[{"label":"check","map":"Cave --- Town\\nTown --- Library\\nTown --- Well\\n\\n{{mapNode}}\\n"},{"label":"Special edition","content":":image[assets/kraid.webp, Samus graphic here]\\n\\nNo noodles please.\\n"}]},"chapter1/test": {"scorge":true,"content":"This is a test of the multi-chapter system.\\n","foobar -- stop list":["one","two","three","four","five","six"],"buttons":[{"label":"This is only","content":"Complete! {{foobar}}\\n"},{"label":"Hello number two","content":"It works!","change":{"chapter0/silkhorn":{"mapNode":"passage[Secret Passage] --- Library\\n"}},"active":["(foobar) is (two)"]},{"label":"Reset","content":"It works!","start":"foobar"},{"label":"A test","go":"chapter0/silkhorn"}]},"gameInfo": {"title":"Adventure","author":"spaceflounder","email":"spaceflounder@hotmail.com","genre":"adventure","start":"chapter0/intro","debug":true,"IFID":"B9CB0924-5538-D237-F7F3-C80A27F9BF10","import":"@import url(\'https://fonts.googleapis.com/css2?family=Cormorant&family=Montserrat:ital,wght@0,100;0,200;0,300;0,400;0,500;0,600;0,700;0,800;0,900;1,100;1,200;1,300;1,400;1,500;1,600;1,700;1,800;1,900&display=swap\');\\n","header font":"Cormorant, Times New Roman","font":"Montserrat, sans-serif","background":"#020213"},"debug": null}';s={};try{I=JSON.parse(e)}catch{throw t=e,document.getElementById("out").append(t),e}var t;if(!!I.gameInfo.debug){const e=I.debug??{};H(I,e)}const n=I.gameInfo.import;if(n){const e=document.createElement("style");e.innerHTML=n,document.head.appendChild(e)}const o=document.createElement("style"),r=I.gameInfo.highlight??"rgba(255, 255, 255, 0.9)",a=I.gameInfo.foreground??"rgba(255, 255, 255, 0.7)",l=I.gameInfo.background??"#0d0d0d";o.innerHTML=`\n    :root {\n        background-color: ${l};\n        color: ${a};\n        font-family: ${I.gameInfo.font};\n    }\n    h1, h2, h3, h4 {\n        font-family: ${I.gameInfo["header font"]};\n        color: ${r};\n    }\n    a {\n        color: ${r};\n        font-family: ${I.gameInfo["header font"]};\n    }\n    `,document.head.appendChild(o);const c=I.gameInfo.start;document.title=I.gameInfo.title,O=c,S(I),R(I[c])}j();