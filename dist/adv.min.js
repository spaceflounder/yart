export const compress=e=>{const t=e,n={},o=[];let r,a,s,c="",i="",l=256;for(r=0;r<256;r+=1)n[String.fromCharCode(r)]=r;for(r=0;r<t.length;r+=1)a=t.charAt(r),s=c+a,n.hasOwnProperty(s)?c=s:(o.push(n[c]),i+=String.fromCharCode(n[c]),n[s]=l++,c=String(a));return""!==c&&(o.push(n[c]),i+=String.fromCharCode(n[c])),i};export const decompress=e=>{let t=e;const n=[];let o,r,a,s,c=[],i="",l=256;for(o=0;o<256;o+=1)n[o]=String.fromCharCode(o);if(t&&"string"==typeof t){for(o=0;o<t.length;o+=1)c.push(t[o].charCodeAt(0));t=c,c=null}for(r=String.fromCharCode(t[0]),a=r,o=1;o<t.length;o+=1){if(s=t[o],n[s])i=n[s];else{if(s!==l)return null;i=r+r.charAt(0)}a+=i,n[l++]=r+i.charAt(0),r=i}return a};import{micromark as e}from"https://esm.sh/micromark@3?bundle";import{directive as t,directiveHtml as n}from"https://esm.sh/micromark-extension-directive@3?bundle";import{gfm as o,gfmHtml as r}from"https://esm.sh/micromark-extension-gfm@3?bundle";import{gfmTable as a,gfmTableHtml as s}from"https://esm.sh/micromark-extension-gfm-table@2?bundle";function c(c){return c=e(c,{extensions:[a(),t(),o()],htmlExtensions:[s(),n({aside:function(e){const t=e.content.replace("<p>","").replace("</p>","");this.tag("<aside>"),this.tag(t),this.tag("</aside>")},image:function(e){let[t,n]=e.label.split(",");t=t??"",n=n??"",t=t.trim(),n=n.trim(),this.tag(`<img src="${t}" alt="${n}" class="image"></img>`)},big_icon:function(e){const t=e.label;this.tag('<span class="material-symbols-outlined iconSize">'),this.tag(t),this.tag("</span>")},kbd:function(e){const t=e.label;this.tag("<kbd>"),this.tag(t),this.tag("</kbd>")},div:function(e){const t=e.content.replace("<p>","").replace("</p>",""),n=e.label;this.tag(`<div class='${n}'>`),this.tag(t),this.tag("</div>")},icon:function(e){const t=e.label;this.tag('<span class="material-symbols-outlined">'),this.tag(t),this.tag("</span>")}}),r()]})}import i from"https://cdn.jsdelivr.net/npm/mermaid@10/dist/mermaid.esm.min.mjs";i.initialize({startOnLoad:!1,securityLevel:"loose",theme:"dark"});let l={};function p(e){let t="",n="";if("."===e[0]&&(e=e.replace(".","+")),-1===e.indexOf(".")?(t=E,n=e):(t=e.split(".")[0]??void 0,n=e.split(".")[1]??void 0),"+"===e[0]&&(e=e.replace("+","."),t=t.replace("+",".")),t=H(t),"state"===n){return L[t][n]??"default"}return L[t]&&L[t][n]?L[t][n]:e}function h(e){const t=[...e.matchAll(/\((.*)\) is \((.*)\)/gm)][0],n=[...e.matchAll(/\((.*)\) not \((.*)\)/gm)][0];if(t&&t.length>0){const e=t[1],n=t[2];return p(e)===p(n)}if(n&&n.length>0){const e=n[1],t=n[2];return p(e)!==p(t)}try{return function(e){const t=[...e.matchAll(/\((.*)\)/g)][0][1];if(!t)throw"Condition not understood: "+e;const n=0===(e=t).indexOf("!"),o=(e=e.replaceAll("!","")).split(".")[0],r=e.split(".")[1];return n?!L[o][r]:!!L[o][r]}(e)}catch{throw"Condition not understood: "+e}}function m(e){return!e.active||[...e.active].filter(e=>h(e)).length>0}function d(e){const t=e?.state??"default",n=document.querySelector("#btns");if(n.innerHTML="",l={...l,...f(e)},"default"!==t){const n=f(e[t]);l={...l,...n}}const o=Object.keys(l).sort((e,t)=>(e?.priority??5)-(t?.priority??5));for(const e of o){const t=document.createElement("button");if(l[e].icon){const n=c(l[e].icon);t.innerHTML=n}t.innerHTML+=l[e].label,t.style=`background-color: ${l[e].color};`,t.onclick=l[e].action,t.alt=l[e].label,n.appendChild(t)}}function f(e){const t={};if(e.buttons){const o=[...e.buttons];for(const e of o){const o=e?.label??void 0,r=e?.color??"#111131",a=e?.icon??"",s=m(e),c=()=>{document.querySelector("#btns").innerHTML="",l={},e.change&&R(L,e.change),T(L);const t=H(e.go);if(t&&L[t]){e.content&&(M=e.content,M=_(M));const n=L[t];l={},E=t,B(n)}else B(),B(e)};o&&s&&(t[o]={label:(n=o,"use"===n&&(n="back_hand"),"key"===n&&(n="vpn_key"),["west","north","south","east","north_west","north_east","south_west","south_east","back_hand","door_open","candle","explosion","map","search","vpn_key","check","cancel","chat"].indexOf(n)>-1?`<span class="material-symbols-outlined iconSize">${n}</span>`:n),icon:a,color:r,action:c})}}var n;return t}const g=/<(\/?)(?:pre|code|kbd|script|math)[^>]*>/i,u=(e="",t="1")=>{var n,o,r,a,s,c=0;if("0"===(t="number"==typeof t?t.toString():t.replace(/\s/g,"")))return e;if("1"===t)n=1,o=1,r=1,a=1;else if("2"===t)n=1,o=1,r=2,a=1;else if("3"===t)n=1,o=1,r=3,a=1;else if("-1"===t)s=1;else for(let e=0;e<t.length;e++){let s=t[e];"q"===s&&(n=1),"b"===s&&(o=1),"B"===s&&(o=2),"d"===s&&(r=1),"D"===s&&(r=2),"i"===s&&(r=3),"e"===s&&(a=1),"w"===s&&(c=1)}var i=A(e),l="",p=0,h="";for(let e=0;e<i.length;e++){let t=i[e];if("tag"===t[0]){l+=t[1];let e=g.exec(t[1]);e&&(p="/"===e[1]?0:1)}else{let e=t[1],i=e.substring(e.length-1,e.length);p||(e=S(e),c&&(e=e.replace(/$quot;/g,'"')),r&&(1===r&&(e=y(e)),2===r&&(e=x(e)),3===r&&(e=k(e))),a&&(e=$(e)),o&&(e=v(e),2===o&&(e=w(e))),n&&(e="'"===e?/\S/.test(h)?"&#8217;":"&#8216;":'"'===e?/\S/.test(h)?"&#8221;":"&#8220;":b(e)),s&&(e=C(e))),h=i,l+=e}}return l},b=e=>{var t="[!\"#$%'()*+,-./:;<=>?@[\\]^_`{|}~]",n="[^\\ \\t\\r\\n\\[\\{\\(\\-]",o="&#8211;|&#8212;";return e=(e=(e=(e=(e=(e=(e=(e=(e=(e=(e=(e=(e=e.replace(new RegExp(`^'(?=${t}\\B)`),"&#8217;")).replace(new RegExp(`^"(?=${t}\\B)`),"&#8221;")).replace(/"'(?=\w)/,"&#8220;&#8216;")).replace(/'"(?=\w)/,"&#8216;&#8220;")).replace(/'(?=\d\d)/,"&#8217;")).replace(new RegExp(`(\\s|&nbsp;|--|&[mn]dash;|${o}|&#x201[34])'(?=\\w)`,"g"),"$1&#8216;")).replace(new RegExp(`(${n})'`,"g"),"$1&#8217;")).replace(new RegExp("([\\ \\t\\r\\n\\[\\{\\(\\-]?)'(?=\\s|s\\b)","g"),"$1&#8217;")).replace(/'/g,"&#8216;")).replace(new RegExp(`(\\s|&nbsp;|--|&[mn]dash;|${o}|&#x201[34])"(?=\\w)`,"g"),"$1&#8220;")).replace(new RegExp(`(${n})"`,"g"),"$1&#8221;")).replace(new RegExp('([\\ \\t\\r\\n\\[\\{\\(\\-]?)"(?=\\s)',"g"),"$1&#8221;")).replace(/"/g,"&#8220;")},v=e=>e=(e=e.replace(/``/g,"&#8220;")).replace(/''/g,"&#8221;"),w=e=>e=(e=e.replace(/`/g,"&#8216;")).replace(/'/g,"&#8217;"),y=e=>e=e.replace(/--/g,"&#8212;"),x=e=>e=(e=e.replace(/---/g,"&#8212;")).replace(/--/g,"&#8211;"),k=e=>e=(e=e.replace(/---/g,"&#8211;")).replace(/--/g,"&#8212;"),$=e=>e=(e=e.replace(/\.\.\./g,"&#8230;")).replace(/\. \. \./g,"&#8230;"),C=e=>e=(e=(e=(e=(e=(e=(e=e.replace(/&#8211;/g,"-")).replace(/&#8212;/g,"--")).replace(/&#8216;/g,"'")).replace(/&#8217;/g,"'")).replace(/&#8220;/g,'"')).replace(/&#8221;/g,'"')).replace(/&#8230;/g,"..."),S=e=>e=(e=(e=(e=(e=(e=e.replace(/\\\\/g,"&#92;")).replace(/\\"/g,"&#34;")).replace(/\\'/g,"&#39;")).replace(/\\\./g,"&#46;")).replace(/\\-/g,"&#45;")).replace(/\\`/g,"&#96;"),A=e=>{for(var t=0,n=e.length,o=[],r=/<!--[\s\S]*?-->|<\?.*?\?>|<[^>]*>/g,a=null;a=r.exec(e);){if(t<a.index){let n=["text",e.substring(t,a.index)];o.push(n)}let n=["tag",a.toString()];o.push(n),t=r.lastIndex}if(t<n){let r=["text",e.substring(t,n)];o.push(r)}return o};function O(e,t,n){const o=L[E]??{},r=e+" index",a=e;let s=!1,c=o[r]??0;n.indexOf("reversed")>-1&&(t=t.reverse()),n.indexOf("shuffled")>-1&&(t=function(e){let t,n=e.length;for(;0!=n;)t=Math.floor(Math.random()*n),n--,[e[n],e[t]]=[e[t],e[n]];return e}(t)),n.indexOf("stop")>-1&&(s=!0);const i=t[c]??"";o[a]=i,c<t.length-1?s?c>-1&&(c+=1):c+=1:s||(c=0),o[r]=c}function T(e){for(const t in e){const n=e[t];for(const e in n)if(Array.isArray(n[e])&&e.indexOf("--")>-1){let[t,o]=e.split("--");if(t=t.trim(),o=o.trim(),o.indexOf("list")>-1){O(t,[...n[e]]??[],o)}}}}import I from"./mustache.js";let E="",M="",L={};function _(e){const t=e.matchAll(/\{\{.*\}\}/gm);if(t)for(const o of t){let t=o[0];const r=o[0],a=t.indexOf("^")>-1;a&&(t=t.replaceAll("^","")),t=t.replaceAll("{{",""),t=t.replaceAll("}}",""),t=t.trim(),-1===t.indexOf(".")&&(t=E+"."+t);let s=I.render(`{{${t}}}`,L).trim();a&&(s=(n=s).charAt(0).toUpperCase()+n.slice(1)),e=e.replace(r,s)}var n;return e}function H(e){if(e&&"."===e[0]&&"/"===e[1]){const t=E.split("/");t.pop();return t.join("/")+(e=e.replace(".",""))}return e}function R(e,t){for(const n in t)try{t[n].constructor==Object?e[n]=R(e[n],t[n]):e[n]=t[n]}catch(o){e[n]=t[n]}return e}function B(e){if(e||(e=L[E]),!e.content&&!e.map)throw"Error: Page not implemented yet!";if(document.querySelector("#out").innerHTML="",e.start&&function(e){let t="",n="";"."===e[0]&&(e=e.replace(".","+")),-1===e.indexOf(".")?(t=E,n=e):(t=e.split(".")[0]??void 0,n=e.split(".")[1]??void 0),"+"===e[0]&&(e=e.replace("+","."),t=t.replace("+",".")),t=H(t);for(const e in L[t])if(e.indexOf("--")>-1){const o=e.split("--")[0].trim();if(n===o){const e=o+" index";return void(L[t][e]=0)}}const o=n+" index";L[t][o]=0}(e.start),e.content&&function(e){const t=document.querySelector("#out"),n=e?.state??"default";let o="";o="default"===n?_(e.content):e[n].content?_(e[n].content):_(e.content),""!==M&&(o=`\n\n${M}\n\n`+o,M=""),o=u(o),o=c(o),t.innerHTML=o}(e),e.map){!async function(e){e=(e="\ngraph TD\n\n\n\n\n"+e).trim();const t=document.querySelector("#out"),n=document.createElement("pre");n.className="mermaid",n.innerHTML=e,t.appendChild(n),await i.run()}(function(e){return e.split("\n").map(e=>_(e)).map(e=>e.indexOf("---")>-1?(e=e.split("---")).map(e=>e.trim()).join("---"):e).join("\n\n")}(e.map))}e.award&&function(e){if(L.achievements[e]&&!L.achievements[e].awarded){L.achievements[e].awarded=!0;const t=L["achievements"][e]?.score??0;L.achievements.score+=t}}(e.award),d(e)}function j(){l={};try{L=JSON.parse('{"chapter0/intro": {"atmos -- shuffled list":["a cheerful little turtle plods by.",null,"the ocean churns and a good wave splashes onto the shore.",null],"content":"# Hello World\\n\\nHere is a simple footnote[^1].\\n\\n***\\n\\nThis is a break.\\n\\n| elephants | tango | giraffe |\\n| - | - | - |\\n| x | y | z |\\n\\n{{ ^atmos }}\\n\\nThe old ~man~ warmed his big, knobby hands by the fire. \\n\\n[^1]: My reference.\\n","buttons":[{"label":"check","content":"Add some content here to start working on your game!","go":"chapter1/test"},{"label":"walk","icon":"::big_icon[directions_walk]","content":"Walk south"},{"label":"search","active":["(chapter1/test.scorge)"],"content":"{{atmos}}\\n"},{"label":"north","content":"{{atmos}}\\n","go":"./silkhorn"}]},"chapter0/silkhorn": {"content":"Blooooo\\n","buttons":[{"label":"check","map":"Cave --- Town\\nTown --- Library\\nTown --- Well\\n\\n{{mapNode}}\\n"},{"label":"Special edition","award":"retrieved golden bird","content":":image[assets/kraid.webp, Samus graphic here]\\n\\nNo noodles please.\\n"}]},"chapter1/test": {"scorge":"Correct","content":"This is a test of the multi-chapter system.\\nCurrent score: {{achievements.bloo}} out of {{achievements.total}}.\\n","foobar -- stop list":["one","two","three","four","five","six"],"buttons":[{"label":"This is only","content":"Complete! {{chapter1/test.foobar}}\\n"},{"label":"Hello number two","content":"It works!","change":{"chapter0/silkhorn":{"mapNode":"passage[Secret Passage] --- Library\\n"}},"active":["(foobar) is (two)"]},{"label":"Reset","content":"It works!","start":"foobar"},{"label":"A test","go":"chapter0/silkhorn"}]},"gameInfo": {"title":"Adventure","author":"spaceflounder","email":"spaceflounder@hotmail.com","genre":"adventure","start":"chapter0/intro","debug":true,"IFID":"B9CB0924-5538-D237-F7F3-C80A27F9BF10","import":"@import url(\'https://fonts.googleapis.com/css2?family=Cormorant&family=Montserrat:ital,wght@0,100;0,200;0,300;0,400;0,500;0,600;0,700;0,800;0,900;1,100;1,200;1,300;1,400;1,500;1,600;1,700;1,800;1,900&display=swap\');\\n","header font":"Cormorant, Times New Roman","font":"Montserrat, sans-serif","background":"#020213"},"achievements": {"retrieved golden bird":{"content":"Retrieved Golden Bird\\n","score":5},"bloo":{"content":"blah\\n"}},"debug": null}')}catch(t){throw e=t,document.getElementById("out").append(e),t}var e;if(!!L.gameInfo.debug){const e=L.debug??{};R(L,e)}!function(){const e=L.gameInfo.import;if(e){const t=document.createElement("style");t.innerHTML=e,document.head.appendChild(t)}const t=document.createElement("style"),n=L.gameInfo.highlight??"rgba(255, 255, 255, 0.9)",o=L.gameInfo.foreground??"rgba(255, 255, 255, 0.7)",r=L.gameInfo.background??"#0d0d0d";t.innerHTML=`\n    :root {\n        background-color: ${r};\n        color: ${o};\n        font-family: ${L.gameInfo.font};\n    }\n    h1, h2, h3, h4 {\n        font-family: ${L.gameInfo["header font"]};\n        color: ${n};\n    }\n    a {\n        color: ${n};\n        font-family: ${L.gameInfo["header font"]};\n    }\n    `,document.head.appendChild(t)}(),function(){let e=0;L.achievements||(L.achievements={});for(const t in L.achievements){const n={...L.achievements[t]}??{};e+=n?.score??0,L.achievements[t].awarded=!1}L.achievements.total=e,L.achievements.score=0}();const t=L.gameInfo.start;document.title=L.gameInfo.title,E=t,T(L),B(L[t])}j();